cmdb时序

# 传统上线流程

第一步：产品经理进行前期调研（需求分析）

第二步：和开发进行评审

第三步：开发进行开发

第四步：测试人员进行测试

第五步：交给业务运维人员上线-->直接将代码打包给业务运维人员，让业务运维人员把代码放到服务器上。服务器上需要配一下域名对外服务。

# 自动分发程序代码的系统

1. 系统有服务器信息（ip、hostname...)
2. 报警自动化
3. 装机系统

## CMDB

主要收集服务器信息：

获取ip地址、获取主机名、获取硬盘信息、获取内存信息

### agent方式（适用于服务器多的情况）

在每一太服务器设置脚本，将脚本执行结果返回给收集信息的服务器（api）,再将收集的信息放到DB服务器，cmdb同伙后台管理操作DB服务器返回给前端CMDB页面。

![img](https://i.loli.net/2018/12/13/5c12079014ea2.png)

### ssh连接

跟angent比不用每台都部署agent，依赖于网络，速度慢，适用于服务器少的

![img](https://i.loli.net/2018/12/13/5c12079077ac1.png)

### saltstack的工作原理

所有服务器安装saltstack软件，用户先录入服务器信息，api服务器录入服务器信息，salt-master计算结果存储到队列，最后将队列中取出的结果发给api服务器，最终写去DB存储。因为计算都是放在saltstack软件中，速度快，开发成本低。

![img](https://i.loli.net/2018/12/13/5c1207920226e.png)

## CMDB时序

### 创建业务域

主要用来填写业务与信息，和负责人，给负责人添加权限

![image-20220225172032699](C:\Users\yaotingtinga\AppData\Roaming\Typora\typora-user-images\image-20220225172032699.png)

### 创建应用程序

填写业务信息、人员信息、git仓库信息（需要找关总关联）

### 配置应用程序

当前项目==》持续交付==》流水线配置

须填写编译命令，实现远程打包脚本

![image-20220225173234513](C:\Users\yaotingtinga\AppData\Roaming\Typora\typora-user-images\image-20220225173234513.png)

### 新建版本

点击开始新的构建，选取分支，

拉取最新代码到服务器，用npm install安装依赖并用npm run build打包，生成镜像

颈项主要包含了程序运行必要的环境和代码的只读文件，镜像之间可以叠加，镜像之间通过镜像ID进行识别。创建Docker容器后，会在所有的镜像层之上增加一个可写层，可以通过命令运行停止。

### 发布到dev环境

将镜像配置到dev环境。
